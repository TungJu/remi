
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>hello_world</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js"></script>

    <script type="text/javascript">
        $(function () {
            // 獲取 CSRF token
            var csrftoken = document.querySelector('[name=csrf-token]').getAttribute('content');
    
            // 初始化 FullCalendar
            $('#calendar').fullCalendar({
                buttonText: {
                    today: '今天',
                    month: '月',
                    week: '周',
                    day: '日',
                },
                allDayText: "全天",
                timeFormat: 'HH:mm',
                views: {
                    month: { titleFormat: 'YYYY年MMMM月' },
                    week: { titleFormat: 'YYYY年MMMM月' },
                    day: { titleFormat: 'YYYY年MMMM月D日' },
                },
                monthNames: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],
                monthNamesShort: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],
                dayNames: ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"],
                dayNamesShort: ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"],
    
                contentHeight: 650,
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                weekends: true,
                events: '/all_daily_log',
                selectable: true,
                selectHelper: true,
                editable: true,
                eventLimit: true,
                select: function (start) {
                    // 顯示表單
                    $('#eventForm').show();
                    // 當表單提交時，使用 async/await 發送 AJAX 請求
                    $('#eventDataForm').on('submit', async function (e) {
                        e.preventDefault();  // 防止表單的默認提交行為
    
                        // 取得表單數據
                        let mental = $('#mental').val();
                        let weight = $('#weight').val();
                        let video = $('#video').val();
                        let time = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
    
                        // 使用 async/await 發送 AJAX 請求
                        try {
                            let response = await $.ajax({
                                type: "post",
                                url: '/add/',
                                headers: {
                                    'X-CSRFToken': csrftoken
                                },
                                data: {
                                    'time': time,
                                    'mental': mental,
                                    'weight': weight,
                                    'video': video
                                },
                                dataType: "json"
                            });
    
                            // 成功後，刷新事件，並隱藏表單
                            $('#calendar').fullCalendar('refetchEvents');
                            alert("Added Successfully");
    
                            // 重設表單並隱藏
                            $('#eventDataForm')[0].reset();
                            $('#eventForm').hide();
                        } catch (error) {
                            alert('There is a problem!!!');
                            console.error(error);  // 打印錯誤信息
                        }
                    });
                },
                eventRender: function(event, element) {
                    // 在事件區域中顯示 mental 值
                    if (event.title) {
                        element.find('.fc-title').text(event.title);
                    }
                }
            });
        });
    </script>
    
    


</head>
<body>
    <br/>
    <h2 align="center"><a href="#">title</a></h2>
    <br/>


    <!-- FullCalendar 容器 -->
    <section class="content">
        <div class="box box-primary">
            <div class="box-body no-padding">
                <!-- THE CALENDAR -->
                <div id="calendar">
                </div>
            </div>
            <!-- /.box-body -->
        </div>
    </section>
    <!-- 表單彈出區域 -->
    <div id="eventForm" style="display:none;">
        <h3>請輸入活動資料</h3>
        <form id="eventDataForm">
            <label for="mental">心理狀態:</label>
            <input type="text" id="mental" name="mental" required><br>

            <label for="weight">體重:</label>
            <input type="text" id="weight" name="weight" required><br>

            <label for="video">視訊連結:</label>
            <input type="text" id="video" name="video" required><br>

            <input type="submit" value="提交">
        </form>
    </div>
    <!-- /.content -->
    <h1>hello_world!</h1>
    {% for r in daily_log_list %}
    <ul>
        <li>time : {{ r.time }}</li>
        <li>mental : {{ r.mental }}</li>
        <li>daily_condition video : {{ r.video }}</li>
    </ul>        
    {% endfor %}
</body>
</html>